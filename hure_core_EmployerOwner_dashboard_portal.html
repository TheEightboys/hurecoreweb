
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>HURE Core Microsaas Dashboard — Employer/Owner (KYC)</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React + ReactDOM (UMD builds) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel so we can use JSX directly in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      html, body, #root { height: 100%; }
      body {
        margin: 0;
        background: #f3f4f6;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useMemo, useEffect } = React;

      function HureCoreMicrosaasDashboard() {
        // ---------------- LocalStorage keys ----------------
        const LS = {
          staff: "hure_staff_v2",
          shifts: "hure_shifts_v2",
          attendances: "hure_attendances_v2",
          leaves: "hure_leaves_v2",
          clinic: "hure_clinic_v2",
          rolesMap: "hure_rolesmap_v2",
          billing: "hure_billing_v2",
          audit: "hure_audit_v2",
        };

        // ---------------- Base state ----------------
        const [view, setView] = useState("dashboard");
        const [showStaffModal, setShowStaffModal] = useState(false);
        const [showShiftModal, setShowShiftModal] = useState(false);
        const [showKycModal, setShowKycModal] = useState(false);
        const [kycTargetId, setKycTargetId] = useState(null);

        // ------- Demo data with licensing + KYC + account fields -------
        const defaultStaff = [
          {
            id: 1,
            firstName: "A.",
            lastName: "Otieno",
            email: "a.otieno@example.com",
            accountRole: "Owner",
            jobRole: "GP",
            phone: "+254700111222",
            status: "On Duty",
            inviteStatus: "active",
            inviteExpiresAt: null,
            licenseType: "KMPDC",
            licenseNumber: "A12345",
            licenseExpiry: "2026-01-15",
            staffKycStatus: "verified",   // not_started | pending_review | verified | rejected | expired
            employmentStatus: "active",   // active | inactive | suspended
          },
          {
            id: 2,
            firstName: "J.",
            lastName: "Mwangi",
            email: "j.mwangi@example.com",
            accountRole: "Admin",
            jobRole: "Nurse",
            phone: "+254700222333",
            status: "Off",
            inviteStatus: "pending",
            inviteExpiresAt: new Date(Date.now() + 15 * 60 * 1000).toISOString(),
            licenseType: "NCK",
            licenseNumber: "RN-98765",
            licenseExpiry: "2025-12-20",
            staffKycStatus: "pending_review",
            employmentStatus: "active",
          },
          {
            id: 3,
            firstName: "R.",
            lastName: "Kiplagat",
            email: "r.kiplagat@example.com",
            accountRole: "HR",
            jobRole: "Lab Tech",
            phone: "+254700333444",
            status: "Available",
            inviteStatus: "none",
            inviteExpiresAt: null,
            licenseType: "KMLTTB",
            licenseNumber: "LAB-5566",
            licenseExpiry: "2027-03-01",
            staffKycStatus: "verified",
            employmentStatus: "active",
          },
          {
            id: 4,
            firstName: "S.",
            lastName: "Achieng",
            email: "s.achieng@example.com",
            accountRole: "Employee",
            jobRole: "Receptionist",
            phone: "+254700444555",
            status: "Off",
            inviteStatus: "none",
            inviteExpiresAt: null,
            licenseType: "",
            licenseNumber: "",
            licenseExpiry: "",
            staffKycStatus: "not_started",
            employmentStatus: "inactive",
          },
        ];

        const defaultShifts = [
          {
            id: 1,
            date: "2025-12-02",
            start: "08:00",
            end: "14:00",
            role: "GP",
            assignedId: 1,
            status: "Confirmed",
          },
        ];

        const defaultAttendances = [
          { id: 1, name: "Dr. A. Otieno", date: "2025-11-09", in: "08:02", out: "14:05" },
        ];

        const defaultLeaves = [
          {
            id: 1,
            name: "Nurse J. Mwangi",
            type: "Sick",
            from: "2025-12-10",
            to: "2025-12-12",
            status: "Pending",
            notes: "Fever",
          },
        ];

        const defaultClinic = {
          name: "Demo Clinic",
          town: "Nairobi",
          phone: "+254700000000",
          kraPin: "P012345678Z",
          licenseNumber: "CLINIC/1234/2025",
          kycStatus: "Verified", // Pending | Verified | Expired
          locations: [{ id: 1, name: "Main Branch", address: "Westlands" }],
        };

        const defaultPermissions = [
          { id: 1, role: "Owner", desc: "Full access" },
          { id: 2, role: "Admin", desc: "Manage staff & schedule" },
          { id: 3, role: "HR", desc: "Manage leave & docs" },
          { id: 4, role: "Employee", desc: "Regular staff (no admin privileges)" },
        ];

        const clinicalRoles = ["GP", "Nurse", "Lab Tech", "Phlebotomist", "Radiographer", "Receptionist"];

        const defaultDocs = [
          { id: 1, title: "Employee Handbook", type: "Policy", uploaded: "2025-07-01", pending: 3, acknowledged: 5 },
          { id: 2, title: "Code of Conduct", type: "Policy", uploaded: "2025-08-12", pending: 1, acknowledged: 7 },
        ];

        const defaultBilling = {
          planName: "Professional",
          planTier: "Monthly",
          amount: 15000,
          currency: "KSh",
          status: "Active",
          nextRenewal: "2025-12-15",
          paymentMethod: "M-Pesa •••• 1234",
          invoices: [
            { id: 1, date: "2025-10-15", amount: 15000, status: "Paid", ref: "INV-001" },
            { id: 2, date: "2025-11-15", amount: 15000, status: "Paid", ref: "INV-002" },
          ],
        };

        const defaultAudit = [
          { id: 1, ts: "2025-11-01 09:15", actor: "A. Otieno", action: "Created staff", details: "Added J. Mwangi as Admin" },
          { id: 2, ts: "2025-11-02 14:20", actor: "J. Mwangi", action: "Created shift", details: "GP shift 08:00–14:00" },
          { id: 3, ts: "2025-11-03 10:05", actor: "R. Kiplagat", action: "Approved leave", details: "Sick leave for J. Mwangi" },
        ];

        // ------------- React state with persistence -------------
        const [staff, setStaff] = useState(() => {
          try {
            return JSON.parse(localStorage.getItem(LS.staff)) || defaultStaff;
          } catch (e) {
            return defaultStaff;
          }
        });

        const [openShifts, setOpenShifts] = useState(() => {
          try {
            return JSON.parse(localStorage.getItem(LS.shifts)) || defaultShifts;
          } catch (e) {
            return defaultShifts;
          }
        });

        const [attendances, setAttendances] = useState(() => {
          try {
            return JSON.parse(localStorage.getItem(LS.attendances)) || defaultAttendances;
          } catch (e) {
            return defaultAttendances;
          }
        });

        const [leaveRequests, setLeaveRequests] = useState(() => {
          try {
            return JSON.parse(localStorage.getItem(LS.leaves)) || defaultLeaves;
          } catch (e) {
            return defaultLeaves;
          }
        });

        const [clinicInfo, setClinicInfo] = useState(() => {
          try {
            return JSON.parse(localStorage.getItem(LS.clinic)) || defaultClinic;
          } catch (e) {
            return defaultClinic;
          }
        });

        const [permissions] = useState(defaultPermissions);
        const [docs] = useState(defaultDocs);

        const [billing, setBilling] = useState(() => {
          try {
            return JSON.parse(localStorage.getItem(LS.billing)) || defaultBilling;
          } catch (e) {
            return defaultBilling;
          }
        });

        const [auditLog, setAuditLog] = useState(() => {
          try {
            return JSON.parse(localStorage.getItem(LS.audit)) || defaultAudit;
          } catch (e) {
            return defaultAudit;
          }
        });

        // persists
        useEffect(() => {
          localStorage.setItem(LS.staff, JSON.stringify(staff));
        }, [staff]);
        useEffect(() => {
          localStorage.setItem(LS.shifts, JSON.stringify(openShifts));
        }, [openShifts]);
        useEffect(() => {
          localStorage.setItem(LS.attendances, JSON.stringify(attendances));
        }, [attendances]);
        useEffect(() => {
          localStorage.setItem(LS.leaves, JSON.stringify(leaveRequests));
        }, [leaveRequests]);
        useEffect(() => {
          localStorage.setItem(LS.clinic, JSON.stringify(clinicInfo));
        }, [clinicInfo]);
        useEffect(() => {
          localStorage.setItem(LS.billing, JSON.stringify(billing));
        }, [billing]);
        useEffect(() => {
          localStorage.setItem(LS.audit, JSON.stringify(auditLog));
        }, [auditLog]);

        const fullName = (s) => `${s.firstName} ${s.lastName}`;

        // --- Licensing & onboarding helpers ---
        function daysUntil(dateStr) {
          if (!dateStr) return Infinity;
          const target = new Date(dateStr);
          if (Number.isNaN(target.getTime())) return Infinity;
          const today = new Date();
          today.setHours(0, 0, 0, 0);
          target.setHours(0, 0, 0, 0);
          const diffMs = target.getTime() - today.getTime();
          return diffMs / (1000 * 60 * 60 * 24);
        }

        function isExpiringSoon(dateStr) {
          const d = daysUntil(dateStr);
          return d >= 0 && d <= 30;
        }

        function getOnboardingStatus(s) {
          const hasContact = !!(s.email || s.phone);
          const hasAnyLicenseField = !!(s.licenseType || s.licenseNumber || s.licenseExpiry);
          const fullLicense =
            !!s.licenseType && !!s.licenseNumber && !!s.licenseExpiry;

          if (hasContact && fullLicense) return "Completed";
          if (hasContact || hasAnyLicenseField) return "In progress";
          return "Not started";
        }

        function onboardingStatusClass(status) {
          if (status === "Completed") return "bg-green-100 text-green-700";
          if (status === "In progress") return "bg-yellow-100 text-yellow-700";
          return "bg-gray-100 text-gray-600";
        }

        // --- KYC + employment helpers ---
        function kycStatusLabel(status) {
          switch (status) {
            case "verified":
              return "KYC Verified";
            case "pending_review":
              return "Pending review";
            case "rejected":
              return "Rejected";
            case "expired":
              return "Expired";
            case "not_started":
            default:
              return "Not started";
          }
        }

        function kycStatusClass(status) {
          switch (status) {
            case "verified":
              return "bg-green-100 text-green-700";
            case "pending_review":
              return "bg-yellow-100 text-yellow-700";
            case "expired":
              return "bg-orange-100 text-orange-700";
            case "rejected":
              return "bg-red-100 text-red-700";
            case "not_started":
            default:
              return "bg-gray-100 text-gray-600";
          }
        }

        function employmentStatusLabel(status) {
          switch (status) {
            case "active":
              return "Active";
            case "inactive":
              return "Inactive";
            case "suspended":
              return "Suspended";
            default:
              return status || "Unknown";
          }
        }

        function employmentStatusClass(status) {
          switch (status) {
            case "active":
              return "bg-green-50 text-green-700 border border-green-200";
            case "inactive":
              return "bg-gray-50 text-gray-600 border border-gray-200";
            case "suspended":
              return "bg-red-50 text-red-700 border border-red-200";
            default:
              return "bg-gray-50 text-gray-600 border border-gray-200";
          }
        }

        function addAudit(actor, action, details) {
          setAuditLog((prev) => {
            const entry = {
              id: prev.length ? Math.max(...prev.map((x) => x.id)) + 1 : 1,
              ts: new Date().toISOString().slice(0, 16).replace("T", " "),
              actor,
              action,
              details,
            };
            return [entry, ...prev];
          });
        }

        function sendInvite(userId, method = "sms") {
          setStaff((prev) =>
            prev.map((s) =>
              s.id === userId
                ? {
                    ...s,
                    inviteStatus: "pending",
                    inviteMethod: method,
                    inviteSentAt: new Date().toISOString(),
                    inviteExpiresAt: new Date(Date.now() + 15 * 60 * 1000).toISOString(),
                  }
                : s
            )
          );
          const target = staff.find((s) => s.id === userId);
          if (target) addAudit("Owner", "Sent invite", `${fullName(target)} via ${method.toUpperCase()}`);
        }

        function revokeInvite(userId) {
          setStaff((prev) =>
            prev.map((s) =>
              s.id === userId ? { ...s, inviteStatus: "none", inviteExpiresAt: null } : s
            )
          );
          const target = staff.find((s) => s.id === userId);
          if (target) addAudit("Owner", "Revoked invite", fullName(target));
        }

        const [newShift, setNewShift] = useState({
          role: clinicalRoles[0],
          date: new Date().toISOString().slice(0, 10),
          start: "08:00",
          end: "12:00",
          assignedId: null,
        });

        const PERMISSION_KEYS = [
          { key: "view_staff", label: "View staff" },
          { key: "create_staff", label: "Create staff" },
          { key: "invite_staff", label: "Invite staff" },
          { key: "view_schedule", label: "View schedule" },
          { key: "create_shift", label: "Create shift" },
          { key: "assign_shift", label: "Assign shift" },
          { key: "view_attendance", label: "View attendance" },
          { key: "export_attendance", label: "Export attendance" },
          { key: "view_leave", label: "View leave" },
          { key: "approve_leave", label: "Approve leave" },
          { key: "view_docs", label: "View docs" },
          { key: "upload_docs", label: "Upload docs" },
          { key: "manage_billing", label: "Manage billing" },
          { key: "manage_permissions", label: "Manage permissions" },
          { key: "view_audit", label: "View audit log" },
        ];

        const [rolesMap, setRolesMap] = useState(() => {
          try {
            const saved = JSON.parse(localStorage.getItem(LS.rolesMap));
            if (saved) return saved;
          } catch (e) {}

          const map = {};
          defaultPermissions.forEach((r) => {
            const permObj = {};
            PERMISSION_KEYS.forEach((pk) => {
              permObj[pk.key] =
                r.role === "Owner"
                  ? true
                  : r.role === "Admin"
                  ? [
                      "view_staff",
                      "create_staff",
                      "invite_staff",
                      "view_schedule",
                      "create_shift",
                      "assign_shift",
                      "view_attendance",
                    ].includes(pk.key)
                  : r.role === "HR"
                  ? ["view_staff", "view_leave", "approve_leave", "view_docs", "upload_docs"].includes(pk.key)
                  : r.role === "Employee"
                  ? ["view_schedule", "view_attendance", "view_docs"].includes(pk.key)
                  : false;
            });
            map[r.role] = { id: r.id, desc: r.desc, perms: permObj };
          });
          return map;
        });

        useEffect(() => {
          localStorage.setItem(LS.rolesMap, JSON.stringify(rolesMap));
        }, [rolesMap]);

        const accountRoles = useMemo(() => permissions.map((p) => p.role), [permissions]);
        const accountRolesExceptOwner = accountRoles.filter((r) => r !== "Owner");

        function hasPermission(permissionKey) {
          const currentUserRole = staff[0]?.accountRole || "Employee"; // assume first is owner
          return !!rolesMap[currentUserRole]?.perms?.[permissionKey];
        }

        function toggleRolePermission(roleName, permissionKey) {
          if (roleName === "Owner") return; // hard guard
          setRolesMap((prev) => ({
            ...prev,
            [roleName]: {
              ...prev[roleName],
              perms: {
                ...prev[roleName].perms,
                [permissionKey]: !prev[roleName].perms[permissionKey],
              },
            },
          }));
        }

        const [newStaff, setNewStaff] = useState({
          firstName: "",
          lastName: "",
          email: "",
          phone: "",
          accountRole: accountRolesExceptOwner[0] || "Admin",
          jobRole: clinicalRoles[0] || "Nurse",
          licenseType: "",
          licenseNumber: "",
          licenseExpiry: "",
          staffKycStatus: "not_started",
          employmentStatus: "inactive",
        });

        function createNewStaff() {
          if (!newStaff.firstName || !newStaff.lastName) {
            alert("First and last name required");
            return;
          }
          const id = staff.length ? Math.max(...staff.map((s) => s.id)) + 1 : 1;
          setStaff((prev) => [
            ...prev,
            {
              id,
              ...newStaff,
              status: "Off",
              inviteStatus: "none",
              inviteExpiresAt: null,
            },
          ]);
          addAudit("Owner", "Created staff", `${newStaff.firstName} ${newStaff.lastName} as ${newStaff.accountRole}`);
          setNewStaff({
            firstName: "",
            lastName: "",
            email: "",
            phone: "",
            accountRole: accountRolesExceptOwner[0] || "Admin",
            jobRole: clinicalRoles[0] || "Nurse",
            licenseType: "",
            licenseNumber: "",
            licenseExpiry: "",
            staffKycStatus: "not_started",
            employmentStatus: "inactive",
          });
          setShowStaffModal(false);
        }

        function openCreateShift() {
          setNewShift({
            role: clinicalRoles[0] || "",
            date: new Date().toISOString().slice(0, 10),
            start: "08:00",
            end: "12:00",
            assignedId: null,
          });
          setShowShiftModal(true);
        }

        function saveShift() {
          const id = openShifts.length ? Math.max(...openShifts.map((s) => s.id)) + 1 : 1;
          setOpenShifts((prev) => [
            ...prev,
            {
              id,
              date: newShift.date,
              start: newShift.start,
              end: newShift.end,
              role: newShift.role,
              assignedId: newShift.assignedId,
              status: "Open",
            },
          ]);
          addAudit("Owner", "Created shift", `${newShift.role} ${newShift.date} ${newShift.start}-${newShift.end}`);
          setShowShiftModal(false);
        }

        const availableStaffByRole = useMemo(() => {
          if (!newShift.role) return staff;
          return staff.filter((s) => s.jobRole === newShift.role);
        }, [staff, newShift.role]);

        const [roleFilter, setRoleFilter] = useState("All");

        const filteredShifts = useMemo(
          () => (roleFilter === "All" ? openShifts : openShifts.filter((s) => s.role === roleFilter)),
          [openShifts, roleFilter]
        );


        function parseTimeToMinutes(t) {
          if (!t) return 0;
          const parts = t.split(":");
          if (parts.length < 2) return 0;
          const h = parseInt(parts[0], 10) || 0;
          const m = parseInt(parts[1], 10) || 0;
          return h * 60 + m;
        }

        function computeHoursBetween(inStr, outStr) {
          const diff = parseTimeToMinutes(outStr) - parseTimeToMinutes(inStr);
          if (!Number.isFinite(diff) || diff <= 0) return 0;
          return diff / 60;
        }

        const payrollSummary = useMemo(
          () => {
            const map = {};
            attendances.forEach((a) => {
              const hours = computeHoursBetween(a.in, a.out);
              if (!map[a.name]) {
                map[a.name] = {
                  name: a.name,
                  days: 0,
                  hours: 0,
                  lastDate: a.date,
                };
              }
              map[a.name].days += 1;
              map[a.name].hours += hours;
              if (a.date > map[a.name].lastDate) {
                map[a.name].lastDate = a.date;
              }
            });
            return Object.values(map);
          },
          [attendances]
        );

        function exportPayrollCsv() {
          if (!payrollSummary.length) {
            alert("No attendance data to export.");
            return;
          }
          const header = ["Name", "Days", "Hours", "Last date"];
          const rows = payrollSummary.map((r) => [
            r.name,
            r.days,
            r.hours.toFixed(2),
            r.lastDate || "",
          ]);
          const csv = [header, ...rows].map((row) =>
            row.map((cell) => `"${String(cell).replace(/"/g, '""')}"`).join(",")
          ).join("\n");
          const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "hure_payroll_export.csv";
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }

        const monthLabel = "November 2025";

        const kycTarget = useMemo(
          () => staff.find((s) => s.id === kycTargetId) || null,
          [staff, kycTargetId]
        );

        function openKycModal(staffId) {
          setKycTargetId(staffId);
          setShowKycModal(true);
        }

        function setStaffKycStatus(staffId, newStatus) {
          setStaff((prev) =>
            prev.map((s) =>
              s.id === staffId
                ? {
                    ...s,
                    staffKycStatus: newStatus,
                    employmentStatus:
                      newStatus === "verified"
                        ? "active"
                        : newStatus === "expired" || newStatus === "rejected"
                        ? "inactive"
                        : s.employmentStatus,
                  }
                : s
            )
          );
          const target = staff.find((s) => s.id === staffId);
          if (target) {
            addAudit(
              "Owner",
              "Updated KYC status",
              `${fullName(target)} → ${kycStatusLabel(newStatus)}`
            );
          }
        }

        // ------------- Render -------------
        return (
          <div className="min-h-screen bg-gray-50 text-gray-800">
            <div className="flex">
              {/* Sidebar */}
              <aside className="w-72 bg-white border-r border-gray-200 min-h-screen sticky top-0 flex flex-col">
                <div className="p-4 border-b">
                  <div className="flex items-center gap-3">
                    <div className="h-10 w-10 rounded-full bg-blue-600 flex items-center justify-center text-white font-semibold">
                      HC
                    </div>
                    <div>
                      <div className="text-sm font-semibold">HURE Core</div>
                      <div className="text-xs text-gray-500">Staff management</div>
                    </div>
                  </div>
                </div>

                <nav className="p-4 space-y-1 text-sm flex-1">
                  <div className="text-xs text-gray-400 uppercase mb-2">Main</div>
                  {hasPermission("view_staff") && (
                    <button
                      onClick={() => setView("dashboard")}
                      className={`block w-full text-left px-3 py-2 rounded-md ${
                        view === "dashboard" ? "bg-blue-50 text-blue-700" : "hover:bg-gray-100"
                      }`}
                    >
                      Dashboard
                    </button>
                  )}
                  {hasPermission("view_staff") && (
                    <button
                      onClick={() => setView("staff")}
                      className={`block w-full text-left px-3 py-2 rounded-md ${
                        view === "staff" ? "bg-blue-50 text-blue-700" : "hover:bg-gray-100"
                      }`}
                    >
                      Staff
                    </button>
                  )}
                  {hasPermission("view_schedule") && (
                    <button
                      onClick={() => setView("schedule")}
                      className={`block w-full text-left px-3 py-2 rounded-md ${
                        view === "schedule" ? "bg-blue-50 text-blue-700" : "hover:bg-gray-100"
                      }`}
                    >
                      Schedule
                    </button>
                  )}
                  {hasPermission("view_attendance") && (
                    <button
                      onClick={() => setView("attendance")}
                      className={`block w-full text-left px-3 py-2 rounded-md ${
                        view === "attendance" ? "bg-blue-50 text-blue-700" : "hover:bg-gray-100"
                      }`}
                    >
                      Attendance
                    </button>
                  )}

                  {hasPermission("view_attendance") && (
                    <button
                      onClick={() => setView("payroll")}
                      className={`block w-full text-left px-3 py-2 rounded-md ${
                        view === "payroll" ? "bg-blue-50 text-blue-700" : "hover:bg-gray-100"
                      }`}
                    >
                      Payroll (export)
                    </button>
                  )}
                  {hasPermission("view_leave") && (
                    <button
                      onClick={() => setView("leave")}
                      className={`block w-full text-left px-3 py-2 rounded-md ${
                        view === "leave" ? "bg-blue-50 text-blue-700" : "hover:bg-gray-100"
                      }`}
                    >
                      Leave
                    </button>
                  )}
                  {hasPermission("view_docs") && (
                    <button
                      onClick={() => setView("clinic")}
                      className={`block w-full text-left px-3 py-2 rounded-md ${
                        view === "clinic" ? "bg-blue-50 text-blue-700" : "hover:bg-gray-100"
                      }`}
                    >
                      Clinic Info & KYC
                    </button>
                  )}
                  {hasPermission("manage_billing") && (
                    <button
                      onClick={() => setView("settings")}
                      className={`block w-full text-left px-3 py-2 rounded-md ${
                        view === "settings" ? "bg-blue-50 text-blue-700" : "hover:bg-gray-100"
                      }`}
                    >
                      Billing & Settings
                    </button>
                  )}
                  {hasPermission("manage_permissions") && (
                    <button
                      onClick={() => setView("permissions")}
                      className={`block w-full text-left px-3 py-2 rounded-md ${
                        view === "permissions" ? "bg-blue-50 text-blue-700" : "hover:bg-gray-100"
                      }`}
                    >
                      Permissions
                    </button>
                  )}
                  {hasPermission("view_docs") && (
                    <button
                      onClick={() => setView("docs")}
                      className={`block w-full text-left px-3 py-2 rounded-md ${
                        view === "docs" ? "bg-blue-50 text-blue-700" : "hover:bg-gray-100"
                      }`}
                    >
                      Docs / Policies
                    </button>
                  )}
                  {hasPermission("view_audit") && (
                    <button
                      onClick={() => setView("audit")}
                      className={`block w-full text-left px-3 py-2 rounded-md ${
                        view === "audit" ? "bg-blue-50 text-blue-700" : "hover:bg-gray-100"
                      }`}
                    >
                      Audit log
                    </button>
                  )}
                </nav>

                <div className="p-4">
                  <div className="text-xs text-gray-400">Need help?</div>
                  <button className="mt-2 w-full text-sm bg-blue-600 text-white px-3 py-2 rounded-md">
                    WhatsApp Support
                  </button>
                </div>
              </aside>

              {/* Main content */}
              <main className="flex-1 p-8">
                <header className="flex items-center justify-between mb-6">
                  <div>
                    <h1 className="text-2xl font-semibold">
                      {view === "dashboard" ? "Welcome, Ubaid" : view.charAt(0).toUpperCase() + view.slice(1)}
                    </h1>
                    <p className="text-sm text-gray-500 mt-1">
                      Simple staff scheduling, onboarding & credentialing for clinics
                    </p>
                  </div>
                  <div className="flex items-center gap-4">
                    <div className="text-right">
                      <div className="text-sm font-medium">{clinicInfo.name}</div>
                      <div className="text-xs text-gray-500">
                        {clinicInfo.town} · {clinicInfo.locations.length} location
                      </div>
                    </div>
                    <div className="h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center">
                      U
                    </div>
                  </div>
                </header>

                {/* Dashboard */}
                {view === "dashboard" && (
                  <div>
                    <section className="grid grid-cols-3 gap-4 mb-6">
                      <div className="bg-white p-4 rounded-lg shadow-sm border">
                        <div className="text-xs text-gray-400">Staff</div>
                        <div className="text-2xl font-semibold mt-2">{staff.length}</div>
                      </div>
                      <div className="bg-white p-4 rounded-lg shadow-sm border">
                        <div className="text-xs text-gray-400">Open shifts</div>
                        <div className="text-2xl font-semibold mt-2">{openShifts.length}</div>
                      </div>
                      <div className="bg-white p-4 rounded-lg shadow-sm border">
                        <div className="text-xs text-gray-400">Today on duty</div>
                        <div className="text-2xl font-semibold mt-2">—</div>
                      </div>
                    </section>

                    <div className="grid grid-cols-3 gap-6">
                      <div className="col-span-2 bg-white p-4 rounded-lg shadow-sm border">
                        <div className="flex items-center justify-between mb-3">
                          <h2 className="text-lg font-semibold">This week's schedule</h2>
                          <div className="text-sm text-gray-500">{monthLabel}</div>
                        </div>
                        <div className="space-y-3">
                          {openShifts.map((s) => (
                            <div
                              key={s.id}
                              className="flex items-center justify-between p-3 rounded-md bg-gray-50 border"
                            >
                              <div>
                                <div className="text-sm font-medium">
                                  {s.date} · {s.start} - {s.end} · {s.role}
                                </div>
                                <div className="text-xs text-gray-500">
                                  Assigned:{" "}
                                  {s.assignedId
                                    ? `${staff.find((x) => x.id === s.assignedId)?.firstName || ""} ${
                                        staff.find((x) => x.id === s.assignedId)?.lastName || ""
                                      }`
                                    : "Unassigned"}
                                </div>
                              </div>
                              <div className="text-sm text-gray-500">{s.status}</div>
                            </div>
                          ))}
                        </div>
                      </div>

                      <div className="bg-white p-4 rounded-lg shadow-sm border">
                        <h3 className="text-lg font-semibold mb-3">Staff & onboarding</h3>
                        <ul className="space-y-3 text-xs">
                          {staff.map((s) => {
                            const status = getOnboardingStatus(s);
                            return (
                              <li key={s.id} className="flex items-center justify-between">
                                <div>
                                  <div className="text-sm font-medium">{fullName(s)}</div>
                                  <div className="text-xs text-gray-500">
                                    {s.accountRole} · {s.jobRole}
                                  </div>
                                </div>
                                <span
                                  className={`px-2 py-0.5 rounded-full text-[11px] ${onboardingStatusClass(
                                    status
                                  )}`}
                                >
                                  {status}
                                </span>
                              </li>
                            );
                          })}
                        </ul>
                      </div>
                    </div>
                  </div>
                )}

                {/* Staff view */}
                {view === "staff" && (
                  <div className="bg-white p-4 rounded-lg shadow-sm border">
                    <div className="flex items-center justify-between mb-4">
                      <div>
                        <h2 className="text-lg font-semibold">Staff onboarding & credentialing</h2>
                        <p className="text-xs text-gray-500 mt-1">
                          Track contact details, licenses, KYC and onboarding status for each staff member.
                        </p>
                      </div>
                      <div className="flex gap-2">
                        {hasPermission("create_staff") ? (
                          <button
                            onClick={() => setShowStaffModal(true)}
                            className="px-3 py-2 rounded-md bg-blue-600 text-white text-sm"
                          >
                            Add staff
                          </button>
                        ) : (
                          <button
                            disabled
                            className="px-3 py-2 rounded-md bg-gray-200 text-gray-500 text-sm"
                          >
                            Add staff
                          </button>
                        )}
                      </div>
                    </div>

                    <div className="overflow-auto">
                      <table className="min-w-full text-xs">
                        <thead>
                          <tr className="text-left text-[11px] text-gray-500 border-b">
                            <th className="py-2 pr-2">First</th>
                            <th className="py-2 pr-2">Last</th>
                            <th className="py-2 pr-2">Email</th>
                            <th className="py-2 pr-2">Account role</th>
                            <th className="py-2 pr-2">Job role</th>
                            <th className="py-2 pr-2">License type</th>
                            <th className="py-2 pr-2">License #</th>
                            <th className="py-2 pr-2">License expiry</th>
                            <th className="py-2 pr-2">Onboarding</th>
                            <th className="py-2 pr-2">KYC</th>
                            <th className="py-2 pr-2">Account</th>
                            <th className="py-2 pr-2">Invite</th>
                            <th className="py-2 pr-2">Actions</th>
                          </tr>
                        </thead>
                        <tbody>
                          {staff.map((s) => {
                            const onboarding = getOnboardingStatus(s);
                            const expSoon = isExpiringSoon(s.licenseExpiry);
                            const kycLabel = kycStatusLabel(s.staffKycStatus);
                            return (
                              <tr key={s.id} className="border-b align-middle">
                                <td className="py-2 pr-2">{s.firstName}</td>
                                <td className="py-2 pr-2">{s.lastName}</td>
                                <td className="py-2 pr-2">{s.email}</td>
                                <td className="py-2 pr-2">{s.accountRole}</td>
                                <td className="py-2 pr-2">{s.jobRole}</td>
                                <td className="py-2 pr-2">{s.licenseType || "—"}</td>
                                <td className="py-2 pr-2">{s.licenseNumber || "—"}</td>
                                <td className="py-2 pr-2">
                                  <div className="flex items-center gap-1">
                                    <span>{s.licenseExpiry || "—"}</span>
                                    {expSoon && s.licenseExpiry && (
                                      <span className="px-1.5 py-0.5 rounded-full bg-orange-100 text-[10px] text-orange-700">
                                        Expiring soon
                                      </span>
                                    )}
                                  </div>
                                </td>
                                <td className="py-2 pr-2">
                                  <span
                                    className={`px-2 py-0.5 rounded-full text-[11px] ${onboardingStatusClass(
                                      onboarding
                                    )}`}
                                  >
                                    {onboarding}
                                  </span>
                                </td>
                                <td className="py-2 pr-2">
                                  <span
                                    className={`px-2 py-0.5 rounded-full text-[11px] ${kycStatusClass(
                                      s.staffKycStatus
                                    )}`}
                                  >
                                    {kycLabel}
                                  </span>
                                </td>
                                <td className="py-2 pr-2">
                                  <span
                                    className={`px-2 py-0.5 rounded-full text-[11px] border ${employmentStatusClass(
                                      s.employmentStatus
                                    )}`}
                                  >
                                    {employmentStatusLabel(s.employmentStatus)}
                                  </span>
                                </td>
                                <td className="py-2 pr-2">
                                  {s.inviteStatus === "active" && (
                                    <span className="text-green-600 text-[11px]">Active</span>
                                  )}
                                  {s.inviteStatus === "pending" && (
                                    <span className="text-yellow-600 text-[11px]">Pending</span>
                                  )}
                                  {s.inviteStatus === "none" && (
                                    <span className="text-gray-500 text-[11px]">None</span>
                                  )}
                                </td>
                                <td className="py-2 pr-2">
                                  <div className="flex flex-wrap gap-1">
                                    {hasPermission("invite_staff") ? (
                                      <button
                                        onClick={() => sendInvite(s.id, "sms")}
                                        className="px-2 py-1 border rounded text-[11px]"
                                      >
                                        SMS
                                      </button>
                                    ) : (
                                      <button
                                        disabled
                                        className="px-2 py-1 border rounded text-[11px] text-gray-400"
                                      >
                                        SMS
                                      </button>
                                    )}
                                    {hasPermission("invite_staff") ? (
                                      <button
                                        onClick={() => sendInvite(s.id, "whatsapp")}
                                        className="px-2 py-1 border rounded text-[11px]"
                                      >
                                        WA
                                      </button>
                                    ) : (
                                      <button
                                        disabled
                                        className="px-2 py-1 border rounded text-[11px] text-gray-400"
                                      >
                                        WA
                                      </button>
                                    )}
                                    {hasPermission("invite_staff") ? (
                                      <button
                                        onClick={() => revokeInvite(s.id)}
                                        className="px-2 py-1 border rounded text-[11px]"
                                      >
                                        Revoke
                                      </button>
                                    ) : (
                                      <button
                                        disabled
                                        className="px-2 py-1 border rounded text-[11px] text-gray-400"
                                      >
                                        Revoke
                                      </button>
                                    )}
                                    <button
                                      onClick={() => openKycModal(s.id)}
                                      className="px-2 py-1 border rounded text-[11px] text-blue-700"
                                    >
                                      Review KYC
                                    </button>
                                  </div>
                                </td>
                              </tr>
                            );
                          })}
                        </tbody>
                      </table>
                    </div>
                  </div>
                )}

                {/* Schedule view */}
                {view === "schedule" && (
                  <div className="bg-white p-4 rounded-lg shadow-sm border">
                    <div className="flex items-center justify-between mb-4">
                      <h2 className="text-lg font-semibold">Schedule</h2>
                      <div>
                        {hasPermission("create_shift") ? (
                          <button
                            onClick={openCreateShift}
                            className="px-3 py-2 rounded-md bg-green-600 text-white text-sm"
                          >
                            Create shift
                          </button>
                        ) : (
                          <button
                            disabled
                            className="px-3 py-2 rounded-md bg-gray-200 text-gray-500 text-sm"
                          >
                            Create shift
                          </button>
                        )}
                      </div>
                    </div>

                    <div className="mb-4">
                      <div className="flex items-center gap-3 mb-3">
                        <label className="text-sm text-gray-600">Go to date</label>
                        <input type="date" className="border p-2 rounded" />
                        <label className="text-sm text-gray-600 ml-4">Filter</label>
                        <select
                          className="border p-2 rounded text-sm"
                          value={roleFilter}
                          onChange={(e) => setRoleFilter(e.target.value)}
                        >
                          <option value="All">All roles</option>
                          {clinicalRoles.map((r) => (
                            <option key={r} value={r}>
                              {r}
                            </option>
                          ))}
                        </select>
                      </div>
                    </div>

                    <div className="space-y-3">
                      {filteredShifts.map((s) => (
                        <div
                          key={s.id}
                          className="flex items-center justify-between p-3 rounded-md bg-gray-50 border"
                        >
                          <div>
                            <div className="text-sm font-medium">
                              {s.date} · {s.start} - {s.end} · {s.role}
                            </div>
                            <div className="text-xs text-gray-500">
                              Assigned:{" "}
                              {s.assignedId
                                ? `${staff.find((x) => x.id === s.assignedId)?.firstName || ""} ${
                                    staff.find((x) => x.id === s.assignedId)?.lastName || ""
                                  }`
                                : "Unassigned"}
                            </div>
                          </div>
                          <div className="text-sm text-gray-500">{s.status}</div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {/* Attendance view */}
                {view === "attendance" && (
                  <div className="bg-white p-4 rounded-lg shadow-sm border">
                    <div className="flex items-center justify-between mb-4">
                      <h2 className="text-lg font-semibold">Attendance</h2>
                      <div>
                        <button className="px-3 py-2 rounded-md bg-white border text-sm">Export</button>
                      </div>
                    </div>

                    <table className="w-full text-sm">
                      <thead>
                        <tr className="text-left text-xs text-gray-500 border-b">
                          <th className="py-2">Name</th>
                          <th className="py-2">Date</th>
                          <th className="py-2">In</th>
                          <th className="py-2">Out</th>
                        </tr>
                      </thead>
                      <tbody>
                        {attendances.map((a) => (
                          <tr key={a.id} className="border-b">
                            <td className="py-2">{a.name}</td>
                            <td className="py-2">{a.date}</td>
                            <td className="py-2">{a.in}</td>
                            <td className="py-2">{a.out}</td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                )}

                {/* Payroll view */}
                {view === "payroll" && (
                  <div className="bg-white p-4 rounded-lg shadow-sm border">
                    <div className="flex items-center justify-between mb-4">
                      <div>
                        <h2 className="text-lg font-semibold">Payroll summary</h2>
                        <p className="text-xs text-gray-500 mt-1">
                          Based on attendance records. Export to CSV for your payroll or accountant.
                        </p>
                      </div>
                      <div>
                        <button
                          onClick={exportPayrollCsv}
                          className="px-3 py-2 rounded-md bg-blue-600 text-white text-sm"
                        >
                          Export CSV
                        </button>
                      </div>
                    </div>

                    {payrollSummary.length === 0 ? (
                      <div className="text-sm text-gray-500">
                        No attendance records yet. Once staff clock in/out, you will see a summary here.
                      </div>
                    ) : (
                      <table className="w-full text-sm">
                        <thead>
                          <tr className="text-left text-xs text-gray-500 border-b">
                            <th className="py-2">Staff</th>
                            <th className="py-2">Days</th>
                            <th className="py-2">Hours (approx.)</th>
                            <th className="py-2">Last date</th>
                          </tr>
                        </thead>
                        <tbody>
                          {payrollSummary.map((row, idx) => (
                            <tr key={idx} className="border-b">
                              <td className="py-2">{row.name}</td>
                              <td className="py-2">{row.days}</td>
                              <td className="py-2">{row.hours.toFixed(2)}</td>
                              <td className="py-2">{row.lastDate}</td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    )}
                  </div>
                )}

                {/* Leave view */}
                {view === "leave" && (
                  <div className="bg-white p-4 rounded-lg shadow-sm border">
                    <h2 className="text-lg font-semibold mb-4">Leave requests</h2>
                    <div className="space-y-3">
                      {leaveRequests.map((r) => (
                        <div
                          key={r.id}
                          className="p-3 rounded-md bg-gray-50 border flex items-start justify-between"
                        >
                          <div>
                            <div className="text-sm font-medium">
                              {r.name} — {r.type}
                            </div>
                            <div className="text-xs text-gray-500">
                              {r.from} to {r.to}
                            </div>
                            <div className="text-xs mt-1">{r.notes}</div>
                          </div>
                          <div className="flex flex-col gap-2">
                            {hasPermission("approve_leave") ? (
                              <>
                                <button
                                  onClick={() =>
                                    setLeaveRequests((prev) =>
                                      prev.map((x) =>
                                        x.id === r.id ? { ...x, status: "Approved" } : x
                                      )
                                    )
                                  }
                                  className="px-3 py-1 rounded-md bg-green-600 text-white text-sm"
                                >
                                  Approve
                                </button>
                                <button
                                  onClick={() =>
                                    setLeaveRequests((prev) =>
                                      prev.map((x) =>
                                        x.id === r.id ? { ...x, status: "Rejected" } : x
                                      )
                                    )
                                  }
                                  className="px-3 py-1 rounded-md bg-white border text-sm"
                                >
                                  Reject
                                </button>
                              </>
                            ) : (
                              <>
                                <button
                                  disabled
                                  className="px-3 py-1 rounded-md bg-gray-200 text-gray-500 text-sm"
                                >
                                  Approve
                                </button>
                                <button
                                  disabled
                                  className="px-3 py-1 rounded-md bg-gray-200 text-gray-500 text-sm"
                                >
                                  Reject
                                </button>
                              </>
                            )}
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {/* Clinic info & KYC */}
                {view === "clinic" && (
                  <div className="bg-white p-4 rounded-lg shadow-sm border w-full max-w-3xl">
                    <h2 className="text-lg font-semibold mb-3">Clinic information & KYC</h2>
                    <div className="grid grid-cols-2 gap-4">
                      <input className="border p-2 rounded" value={clinicInfo.name} readOnly />
                      <input className="border p-2 rounded" value={clinicInfo.town} readOnly />
                      <input className="border p-2 rounded" value={clinicInfo.phone} readOnly />
                      <input className="border p-2 rounded" value={clinicInfo.kraPin} readOnly />
                      <input className="border p-2 rounded" value={clinicInfo.licenseNumber} readOnly />
                      <div className="flex items-center gap-2 text-sm">
                        <span className="text-gray-600">KYC status:</span>
                        <span
                          className={`px-2 py-0.5 rounded-full text-xs ${
                            clinicInfo.kycStatus === "Verified"
                              ? "bg-green-100 text-green-700"
                              : clinicInfo.kycStatus === "Pending"
                              ? "bg-yellow-100 text-yellow-700"
                              : "bg-red-100 text-red-700"
                          }`}
                        >
                          {clinicInfo.kycStatus}
                        </span>
                      </div>
                      <div className="col-span-2">
                        <h3 className="text-sm font-medium mb-2">Locations</h3>
                        <ul className="space-y-2">
                          {clinicInfo.locations.map((loc) => (
                            <li key={loc.id} className="p-2 border rounded">
                              {loc.name} — {loc.address}
                            </li>
                          ))}
                        </ul>
                      </div>
                    </div>
                  </div>
                )}

                {/* Billing & Settings */}
                {view === "settings" && (
                  <div className="bg-white p-4 rounded-lg shadow-sm border">
                    <h2 className="text-lg font-semibold mb-4">Billing & Subscription</h2>
                    <div className="grid grid-cols-3 gap-4 mb-6">
                      <div className="col-span-2 border rounded-lg p-4">
                        <div className="flex items-center justify-between mb-2">
                          <div>
                            <div className="text-sm text-gray-500">Current plan</div>
                            <div className="text-lg font-semibold">
                              {billing.planName} · {billing.planTier}
                            </div>
                          </div>
                          <span className="px-2 py-1 rounded-full text-xs bg-green-100 text-green-700">
                            {billing.status}
                          </span>
                        </div>
                        <div className="text-sm text-gray-600 mb-1">
                          {billing.currency} {billing.amount.toLocaleString()} / month
                        </div>
                        <div className="text-xs text-gray-500">
                          Next renewal: {billing.nextRenewal}
                        </div>
                        <div className="text-xs text-gray-500 mt-1">
                          Payment method: {billing.paymentMethod}
                        </div>
                      </div>
                      <div className="border rounded-lg p-4 text-sm">
                        <div className="font-semibold mb-1">Plan actions</div>
                        <ul className="space-y-1 text-xs text-gray-600">
                          <li>• Change plan (upgrade/downgrade)</li>
                          <li>• Add extra staff/locations</li>
                          <li>• Download contract</li>
                        </ul>
                      </div>
                    </div>

                    <h3 className="text-sm font-semibold mb-2">Invoices</h3>
                    <table className="w-full text-sm">
                      <thead>
                        <tr className="text-left text-xs text-gray-500 border-b">
                          <th className="py-2">Date</th>
                          <th className="py-2">Ref</th>
                          <th className="py-2">Amount</th>
                          <th className="py-2">Status</th>
                        </tr>
                      </thead>
                      <tbody>
                        {billing.invoices.map((inv) => (
                          <tr key={inv.id} className="border-b">
                            <td className="py-2">{inv.date}</td>
                            <td className="py-2">{inv.ref}</td>
                            <td className="py-2">
                              {billing.currency} {inv.amount.toLocaleString()}
                            </td>
                            <td className="py-2 text-green-700">{inv.status}</td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                )}

                {/* Permissions matrix */}
                {view === "permissions" && (
                  <div className="bg-white p-4 rounded-lg shadow-sm border">
                    <h2 className="text-lg font-semibold mb-3">Permissions & Roles</h2>
                    <p className="text-xs text-gray-500 mb-4">
                      Owner is locked with full access. Admin, HR, and Employee can be tuned below.
                    </p>
                    <div className="overflow-auto">
                      <table className="min-w-full text-xs">
                        <thead>
                          <tr>
                            <th className="text-left py-2 pr-4">Permission</th>
                            {Object.keys(rolesMap).map((roleName) => (
                              <th key={roleName} className="px-2 py-2 text-center">
                                {roleName}
                              </th>
                            ))}
                          </tr>
                        </thead>
                        <tbody>
                          {PERMISSION_KEYS.map((pk) => (
                            <tr key={pk.key} className="border-t">
                              <td className="py-1 pr-4 text-xs text-gray-600">{pk.label}</td>
                              {Object.keys(rolesMap).map((roleName) => {
                                const disabled = roleName === "Owner";
                                const checked = !!rolesMap[roleName]?.perms?.[pk.key];
                                return (
                                  <td key={roleName} className="px-2 py-1 text-center">
                                    <input
                                      type="checkbox"
                                      disabled={disabled}
                                      checked={checked}
                                      onChange={() => toggleRolePermission(roleName, pk.key)}
                                    />
                                  </td>
                                );
                              })}
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </div>
                )}

                {/* Docs / Policies */}
                {view === "docs" && (
                  <div className="bg-white p-4 rounded-lg shadow-sm border">
                    <h2 className="text-lg font-semibold mb-3">Documents & Policies</h2>
                    <ul className="space-y-2">
                      {docs.map((d) => (
                        <li
                          key={d.id}
                          className="p-3 border rounded flex items-center justify-between text-sm"
                        >
                          <div>
                            <div className="font-medium">{d.title}</div>
                            <div className="text-xs text-gray-500">
                              {d.type} · Uploaded {d.uploaded} · Pending {d.pending} · Acknowledged {d.acknowledged}
                            </div>
                          </div>
                          <button className="text-xs text-blue-600 border px-2 py-1 rounded">
                            View
                          </button>
                        </li>
                      ))}
                    </ul>
                  </div>
                )}

                {/* Audit log */}
                {view === "audit" && (
                  <div className="bg-white p-4 rounded-lg shadow-sm border">
                    <h2 className="text-lg font-semibold mb-3">Audit log</h2>
                    <table className="w-full text-xs">
                      <thead>
                        <tr className="text-left text-gray-500 border-b">
                          <th className="py-2">Time</th>
                          <th className="py-2">Actor</th>
                          <th className="py-2">Action</th>
                          <th className="py-2">Details</th>
                        </tr>
                      </thead>
                      <tbody>
                        {auditLog.map((entry) => (
                          <tr key={entry.id} className="border-b">
                            <td className="py-2 whitespace-nowrap">{entry.ts}</td>
                            <td className="py-2 whitespace-nowrap">{entry.actor}</td>
                            <td className="py-2 whitespace-nowrap">{entry.action}</td>
                            <td className="py-2">{entry.details}</td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                )}

                {/* Staff modal */}
                {showStaffModal && (
                  <div className="fixed inset-0 z-50 flex items-center justify-center">
                    <div
                      className="absolute inset-0 bg-black opacity-30"
                      onClick={() => setShowStaffModal(false)}
                    />
                    <div className="bg-white rounded-lg p-6 w-96 z-10">
                      <h3 className="text-lg font-semibold mb-3">Add staff</h3>
                      <div className="space-y-2 text-sm">
                        <input
                          className="w-full border p-2 rounded"
                          placeholder="First name"
                          value={newStaff.firstName}
                          onChange={(e) => setNewStaff({ ...newStaff, firstName: e.target.value })}
                        />
                        <input
                          className="w-full border p-2 rounded"
                          placeholder="Last name"
                          value={newStaff.lastName}
                          onChange={(e) => setNewStaff({ ...newStaff, lastName: e.target.value })}
                        />
                        <input
                          className="w-full border p-2 rounded"
                          placeholder="Email"
                          value={newStaff.email}
                          onChange={(e) => setNewStaff({ ...newStaff, email: e.target.value })}
                        />
                        <input
                          className="w-full border p-2 rounded"
                          placeholder="Phone"
                          value={newStaff.phone}
                          onChange={(e) => setNewStaff({ ...newStaff, phone: e.target.value })}
                        />
                        <div className="text-xs text-gray-500 mt-2">Account role</div>
                        <select
                          className="w-full border p-2 rounded"
                          value={newStaff.accountRole}
                          onChange={(e) => setNewStaff({ ...newStaff, accountRole: e.target.value })}
                        >
                          {accountRolesExceptOwner.map((r) => (
                            <option key={r} value={r}>
                              {r}
                            </option>
                          ))}
                        </select>
                        <div className="text-xs text-gray-500 mt-2">Job role</div>
                        <select
                          className="w-full border p-2 rounded"
                          value={newStaff.jobRole}
                          onChange={(e) => setNewStaff({ ...newStaff, jobRole: e.target.value })}
                        >
                          {clinicalRoles.map((r) => (
                            <option key={r} value={r}>
                              {r}
                            </option>
                          ))}
                        </select>

                        {/* Licensing fields */}
                        <div className="text-xs text-gray-500 mt-3">License type (for clinicians)</div>
                        <select
                          className="w-full border p-2 rounded"
                          value={newStaff.licenseType}
                          onChange={(e) => setNewStaff({ ...newStaff, licenseType: e.target.value })}
                        >
                          <option value="">Not applicable / None</option>
                          <option value="KMPDC">KMPDC</option>
                          <option value="NCK">NCK</option>
                          <option value="KMLTTB">KMLTTB</option>
                          <option value="PPB">PPB</option>
                          <option value="Other">Other</option>
                        </select>

                        <div className="text-xs text-gray-500 mt-2">License number</div>
                        <input
                          className="w-full border p-2 rounded"
                          placeholder="e.g. A12345"
                          value={newStaff.licenseNumber}
                          onChange={(e) => setNewStaff({ ...newStaff, licenseNumber: e.target.value })}
                        />

                        <div className="text-xs text-gray-500 mt-2">License expiry date</div>
                        <input
                          type="date"
                          className="w-full border p-2 rounded"
                          value={newStaff.licenseExpiry}
                          onChange={(e) => setNewStaff({ ...newStaff, licenseExpiry: e.target.value })}
                        />

                        <div className="flex justify-end gap-2 mt-4">
                          <button
                            onClick={() => setShowStaffModal(false)}
                            className="px-3 py-2 rounded-md bg-white border text-sm"
                          >
                            Cancel
                          </button>
                          <button
                            onClick={createNewStaff}
                            className="px-3 py-2 rounded-md bg-blue-600 text-white text-sm"
                          >
                            Save
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {/* Shift modal */}
                {showShiftModal && (
                  <div className="fixed inset-0 z-50 flex items-center justify-center">
                    <div
                      className="absolute inset-0 bg-black opacity-30"
                      onClick={() => setShowShiftModal(false)}
                    />
                    <div className="bg-white rounded-lg p-6 w-96 z-10">
                      <h3 className="text-lg font-semibold mb-3">Create shift</h3>
                      <div className="space-y-2 text-sm">
                        <div>
                          <div className="text-xs text-gray-500 mb-1">Role</div>
                          <select
                            className="w-full border p-2 rounded"
                            value={newShift.role}
                            onChange={(e) => setNewShift({ ...newShift, role: e.target.value })}
                          >
                            {clinicalRoles.map((r) => (
                              <option key={r} value={r}>
                                {r}
                              </option>
                            ))}
                          </select>
                        </div>
                        <div className="grid grid-cols-2 gap-2">
                          <div>
                            <div className="text-xs text-gray-500 mb-1">Date</div>
                            <input
                              type="date"
                              className="w-full border p-2 rounded"
                              value={newShift.date}
                              onChange={(e) => setNewShift({ ...newShift, date: e.target.value })}
                            />
                          </div>
                          <div>
                            <div className="text-xs text-gray-500 mb-1">Start time</div>
                            <input
                              type="time"
                              step={300}
                              className="w-full border p-2 rounded"
                              value={newShift.start}
                              onChange={(e) => setNewShift({ ...newShift, start: e.target.value })}
                            />
                          </div>
                        </div>
                        <div className="grid grid-cols-2 gap-2">
                          <div>
                            <div className="text-xs text-gray-500 mb-1">End time</div>
                            <input
                              type="time"
                              step={300}
                              className="w-full border p-2 rounded"
                              value={newShift.end}
                              onChange={(e) => setNewShift({ ...newShift, end: e.target.value })}
                            />
                          </div>
                          <div>
                            <div className="text-xs text-gray-500 mb-1">Assign to</div>
                            <select
                              className="w-full border p-2 rounded"
                              value={newShift.assignedId || ""}
                              onChange={(e) =>
                                setNewShift({
                                  ...newShift,
                                  assignedId: e.target.value ? Number(e.target.value) : null,
                                })
                              }
                            >
                              <option value="">Unassigned</option>
                              {availableStaffByRole.map((s) => (
                                <option key={s.id} value={s.id}>
                                  {fullName(s)}
                                </option>
                              ))}
                            </select>
                          </div>
                        </div>
                        <div className="flex justify-end gap-2 mt-4">
                          <button
                            onClick={() => setShowShiftModal(false)}
                            className="px-3 py-2 rounded-md bg-white border text-sm"
                          >
                            Cancel
                          </button>
                          <button
                            onClick={saveShift}
                            className="px-3 py-2 rounded-md bg-green-600 text-white text-sm"
                          >
                            Save shift
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {/* KYC review modal */}
                {showKycModal && kycTarget && (
                  <div className="fixed inset-0 z-50 flex items-center justify-center">
                    <div
                      className="absolute inset-0 bg-black opacity-30"
                      onClick={() => setShowKycModal(false)}
                    />
                    <div className="bg-white rounded-lg p-6 w-[420px] z-10">
                      <h3 className="text-lg font-semibold mb-2">Review KYC / Credentials</h3>
                      <p className="text-xs text-gray-500 mb-4">
                        Check license details and mark this staff as Verified, Pending, Rejected, or Expired.
                      </p>

                      <div className="space-y-2 text-sm mb-4">
                        <div>
                          <span className="font-medium">{fullName(kycTarget)}</span>{" "}
                          <span className="text-xs text-gray-500">
                            · {kycTarget.accountRole} · {kycTarget.jobRole}
                          </span>
                        </div>
                        <div className="text-xs text-gray-500">
                          Email: {kycTarget.email || "—"} · Phone: {kycTarget.phone || "—"}
                        </div>

                        <div className="mt-3 border-t pt-3 space-y-1">
                          <div className="text-xs text-gray-500 uppercase tracking-wide">
                            License details
                          </div>
                          <div>Type: {kycTarget.licenseType || "—"}</div>
                          <div>Number: {kycTarget.licenseNumber || "—"}</div>
                          <div>
                            Expiry: {kycTarget.licenseExpiry || "—"}
                            {isExpiringSoon(kycTarget.licenseExpiry) && kycTarget.licenseExpiry && (
                              <span className="ml-2 px-1.5 py-0.5 rounded-full bg-orange-100 text-[10px] text-orange-700">
                                Expiring soon
                              </span>
                            )}
                          </div>
                        </div>

                        <div className="mt-3 border-t pt-3 flex items-center justify-between">
                          <div className="text-xs text-gray-500">Current KYC status</div>
                          <span
                            className={`px-2 py-0.5 rounded-full text-xs ${kycStatusClass(
                              kycTarget.staffKycStatus
                            )}`}
                          >
                            {kycStatusLabel(kycTarget.staffKycStatus)}
                          </span>
                        </div>
                      </div>

                      <div className="flex justify-between items-center mt-4">
                        <button
                          onClick={() => setShowKycModal(false)}
                          className="px-3 py-2 rounded-md bg-white border text-xs"
                        >
                          Close
                        </button>
                        <div className="flex gap-2">
                          <button
                            onClick={() => {
                              setStaffKycStatus(kycTarget.id, "pending_review");
                              setShowKycModal(false);
                            }}
                            className="px-3 py-1 rounded-md bg-gray-100 text-gray-700 text-xs"
                          >
                            Mark pending
                          </button>
                          <button
                            onClick={() => {
                              setStaffKycStatus(kycTarget.id, "verified");
                              setShowKycModal(false);
                            }}
                            className="px-3 py-1 rounded-md bg-green-600 text-white text-xs"
                          >
                            Verify
                          </button>
                          <button
                            onClick={() => {
                              setStaffKycStatus(kycTarget.id, "rejected");
                              setShowKycModal(false);
                            }}
                            className="px-3 py-1 rounded-md bg-red-600 text-white text-xs"
                          >
                            Reject
                          </button>
                          <button
                            onClick={() => {
                              setStaffKycStatus(kycTarget.id, "expired");
                              setShowKycModal(false);
                            }}
                            className="px-3 py-1 rounded-md bg-orange-500 text-white text-xs"
                          >
                            Mark expired
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                <div className="mt-8 text-sm text-gray-500">
                  Tip: Keep the dashboard focused — everything else can be a plugin in Settings.
                </div>
              </main>
            </div>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<HureCoreMicrosaasDashboard />);
    </script>
  </body>
</html>
